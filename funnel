import codecademylib3
import pandas as pd

visits = pd.read_csv('visits.csv',
                     parse_dates=[1])
cart = pd.read_csv('cart.csv',
                   parse_dates=[1])
checkout = pd.read_csv('checkout.csv',
                       parse_dates=[1])
purchase = pd.read_csv('purchase.csv',
                       parse_dates=[1])

print(visits.head(3))
print(cart.head(3))
print(checkout.head(3))
print(purchase.head(3))

####funnel for cool tshirts inc.

visits_cart = pd.merge(
  visits,
  cart,
  how='left'
)
print(visits_cart)
#NaT = not a time, meaning user didn't add tshirt to cart.
visits = len(visits_cart.user_id)
print(visits)
#2000 rows * 3 col.
#2000 rows

#no_cart = len(visits_cart[visits_cart.cart_time.isnull()])
no_cart = visits_cart.cart_time.isnull().sum()
print('no cart =' + str(no_cart))
#1652 rows * 3 col.
#1652 rows

visit_no_cart = float(no_cart)/float(visits)
print(visit_no_cart)
#82.6% of users who visited cool t-shirts inc. ended up not placing a tshirt in their cart.

cart_checkout = pd.merge(
  cart,
  checkout,
  how='left'
)

carts = len(cart_checkout.user_id)
no_checkout = cart_checkout.checkout_time.isnull().sum()
cart_no_checkout = float(no_checkout)/float(carts)
print(cart_no_checkout)
#25.31% of users put items in cart but did not checkout

all_data = visits_cart.merge(
  cart_checkout, 
  how='left').merge(
    purchase,
    how='left'
  )
print(all_data.head(4))

checkout = all_data.checkout_time.count()
no_purchase = all_data.purchase_time[all_data.checkout_time.notnull()].isnull().sum()
print("checkout " + str(checkout))
print("no_purch " + str(no_purchase))
checkout_no_purchase = no_purchase/checkout
print(checkout_no_purchase)
#16.8% 
#virer tous les floats
#step1 => highest percentage of users not putting tshirt in cart. maybe tshirts aren't cool enough??

####Average Time To Purchase
all_data['time_to_purchase'] = all_data.purchase_time \
 - all_data.visit_time
print(all_data['time_to_purchase'])

time_to_purch_avg = all_data['time_to_purchase'].mean()
print(time_to_purch_avg)
#43min53secs.
